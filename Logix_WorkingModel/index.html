<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logix AI Research</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Custom scrollbar for better look */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9; /* slate-100 */
        }
        ::-webkit-scrollbar-thumb {
            background: #94a3b8; /* slate-400 */
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b; /* slate-500 */
        }
        .prose h3 {
            color: #1e293b; /* slate-800 */
        }
        .prose h4 {
            color: #334155; /* slate-700 */
        }
        .prose p {
            color: #475569; /* slate-600 */
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50 text-slate-800 font-sans">

    <div id="splash-screen" class="fixed top-0 left-0 w-full h-full bg-slate-800 flex items-center justify-center z-50 transition-opacity duration-500 ease-in-out">
        <h1 class="text-6xl md:text-8xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-orange-400 to-amber-400 flex items-center gap-4">
            <i data-lucide="brain-circuit" class="w-12 h-12 md:w-20 md:h-20"></i>
            Logix
        </h1>
    </div>
    
    <div id="app-wrapper" class="hidden w-full h-full flex">
        <aside id="sidebar-container" class="fixed top-0 left-0 h-full bg-slate-800 text-gray-200 border-r border-gray-700/50 z-30 w-64 flex flex-col">
            </aside>

        <main class="flex-grow ml-64">
            <div class="flex flex-col h-screen">
                <header class="flex items-center justify-end p-4 border-b border-gray-200/80 bg-white/80 backdrop-blur-sm sticky top-0 z-20">
                    <div class="flex items-center gap-4 text-sm">
                        <div class="text-center">
                            <p id="questions-asked" class="font-bold text-lg text-orange-600">0</p>
                            <p class="text-xs text-gray-500">Questions</p>
                        </div>
                        <div class="h-6 border-r border-gray-300"></div>
                        <div class="text-center">
                            <p id="reports-generated" class="font-bold text-lg text-green-600">0</p>
                            <p class="text-xs text-gray-500">Reports</p>
                        </div>
                    </div>
                </header>

                <div id="main-content-area" class="flex-grow flex flex-col justify-center items-center overflow-y-auto p-4 md:p-8">
                    </div>

                <div id="input-area-container" class="p-4 md:px-8 mt-auto w-full max-w-4xl mx-auto">
                     </div>
            </div>
        </main>
    </div>

    <script>
        // --- STATE MANAGEMENT ---
        let state = {
            question: '',
            uploadedFiles: [],
            isGenerating: false,
            report: null,
            questionsAsked: 0,
            reportsGenerated: 0,
            error: '',
            history: [],
            projects: [],
            activeView: 'New Chat',
        };

        // --- DOM SELECTORS ---
        const sidebarContainer = document.getElementById('sidebar-container');
        const mainContentArea = document.getElementById('main-content-area');
        const inputAreaContainer = document.getElementById('input-area-container');
        const questionsAskedEl = document.getElementById('questions-asked');
        const reportsGeneratedEl = document.getElementById('reports-generated');

        // --- MOCK DATA ---
        const createMockReport = (qCount, rCount) => ({
            keyTakeaways: [
                "Real-time data ingestion ensures reports are always current.",
                "Granular usage tracking provides clear cost management.",
                "High accuracy in extracting insights from diverse data sources.",
                "Scalable infrastructure supports growing user demand seamlessly."
            ],
            fullReport: `<h3>Executive Summary</h3><p>This AI-generated report details the successful implementation of a Research Assistant Agent. The integration of a live data ingestion pipeline and a granular usage-based billing system are key features that drive its value proposition. The system demonstrates high accuracy in parsing and summarizing data from a multitude of sources, including academic papers, news articles, and financial reports.</p><h4>Core Functionality</h4><p>The agent leverages advanced natural language processing (NLP) models to understand user queries, retrieve relevant information, and synthesize it into a coherent, structured report. The process includes semantic search, entity recognition, and summarization algorithms to ensure the output is both comprehensive and concise.</p><h4>Usage-Based Billing and Analytics</h4><p>The billing mechanism tracks two key metrics: questions asked and reports generated. This model offers flexibility for users, from casual researchers to enterprise teams. Current usage for this session: <strong>${qCount + 1} questions asked</strong> & <strong>${rCount + 1} reports generated</strong>.</p>`,
            sources: [
                { title: "Pathway Real-time Data Ingestion Whitepaper", url: "https://example.com/pathway-whitepaper", type: 'Document' },
                { title: "Flexprice API Documentation", url: "https://example.com/flexprice-docs", type: 'API Docs' },
                { title: "Live News Feed: Tech Market Trends Update", url: "https://example.com/tech-news-feed", type: 'Live Data' },
            ]
        });

        const mockLibraryItems = [
            { id: 1, title: "Quantum Computing Final Report", date: "2023-09-15", type: "Report" },
            { id: 2, title: "Market Analysis on AI Startups", date: "2023-09-12", type: "Analysis" },
            { id: 3, title: "Draft: The Future of Renewable Energy", date: "2023-09-10", type: "Draft" },
        ];

        // --- LOCAL STORAGE ---
        const saveState = () => {
            try {
                localStorage.setItem('logixHistory_html_v4', JSON.stringify(state.history));
                localStorage.setItem('logixProjects_html_v4', JSON.stringify(state.projects));
                localStorage.setItem('logixQuestions_html_v4', state.questionsAsked.toString());
                localStorage.setItem('logixReports_html_v4', state.reportsGenerated.toString());
            } catch (e) {
                console.error("Error saving data to localStorage:", e);
            }
        };

        const loadState = () => {
            try {
                state.history = JSON.parse(localStorage.getItem('logixHistory_html_v4')) || [];
                state.projects = JSON.parse(localStorage.getItem('logixProjects_html_v4')) || [];
                state.questionsAsked = parseInt(localStorage.getItem('logixQuestions_html_v4'), 10) || 0;
                state.reportsGenerated = parseInt(localStorage.getItem('logixReports_html_v4'), 10) || 0;
            } catch (e) {
                console.error("Error loading data from localStorage:", e);
            }
        };

        // --- RENDER FUNCTIONS ---
        const renderSidebar = () => {
            const navItems = [
                { icon: 'plus-circle', label: 'New Chat' },
                { icon: 'search', label: 'Discover' },
                { icon: 'library', label: 'Library' },
                { icon: 'edit-3', label: 'Writer' },
                { icon: 'star', label: 'Projects' },
            ];

            const historyHtml = state.history.length > 0
                ? state.history.map(item => `<p class="text-sm text-gray-300 truncate cursor-pointer hover:bg-gray-700 p-2 rounded-md transition-colors history-item" title="${item}">${item}</p>`).join('')
                : `<p class="text-sm text-gray-500 text-center py-4 px-2">No recent searches.</p>`;

            const projectsHtml = state.projects.length > 0
                ? state.projects.map(proj => `<p class="text-sm text-gray-300 truncate cursor-pointer hover:bg-gray-700 p-2 rounded-md transition-colors project-item" data-projectname="${proj.name}" title="${proj.name}">${proj.name}</p>`).join('')
                : `<p class="text-sm text-gray-500 text-center py-4 px-2">No saved projects.</p>`;
            
            sidebarContainer.innerHTML = `
                <div class="flex items-center justify-between p-4 border-b border-gray-700/50">
                    <h1 class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-orange-400 to-amber-400 flex items-center gap-2">
                        <i data-lucide="brain-circuit"></i> Logix
                    </h1>
                </div>
                <nav class="p-2 flex-grow">
                    <ul class="space-y-1">
                        ${navItems.map(item => `
                            <li>
                                <a href="#" data-view="${item.label}" class="nav-item flex items-center gap-3 p-3 rounded-lg text-sm font-medium transition-colors ${state.activeView === item.label ? 'bg-orange-500/20 text-orange-400' : 'text-gray-300 hover:bg-gray-700 hover:text-white'}">
                                    <i data-lucide="${item.icon}" class="w-5 h-5"></i>
                                    <span>${item.label}</span>
                                </a>
                            </li>
                        `).join('')}
                    </ul>
                    <div class="border-t border-gray-700/50 my-4"></div>
                    <h2 class="text-sm font-semibold text-gray-400 px-3 mb-2 flex items-center gap-2"><i data-lucide="history" class="w-4 h-4"></i> Recent Searches</h2>
                    <div id="history-list" class="overflow-y-auto space-y-1 pr-1 max-h-32">${historyHtml}</div>
                    <div class="border-t border-gray-700/50 my-4"></div>
                    <h2 class="text-sm font-semibold text-gray-400 px-3 mb-2 flex items-center gap-2"><i data-lucide="star" class="w-4 h-4"></i> Saved Projects</h2>
                    <div id="projects-list" class="overflow-y-auto space-y-1 pr-1 max-h-32">${projectsHtml}</div>
                </nav>
                <div class="p-4 border-t border-gray-700/50">
                    ${state.history.length > 0 ? `<button id="clear-history-btn" class="flex items-center justify-center gap-2 w-full text-sm text-red-400 hover:bg-red-500/20 py-2 rounded-md transition-colors"><i data-lucide="trash-2" class="w-3.5 h-3.5"></i> Clear History</button>` : ''}
                    ${state.projects.length > 0 ? `<button id="clear-projects-btn" class="flex items-center justify-center gap-2 w-full text-sm text-red-400 hover:bg-red-500/20 py-2 rounded-md transition-colors mt-1"><i data-lucide="trash-2" class="w-3.5 h-3.5"></i> Clear Projects</button>` : ''}
                    <a href="mailto:support@logix.ai" class="flex items-center justify-center gap-2 w-full text-sm text-gray-300 hover:bg-gray-700 py-2 rounded-md transition-colors mt-2"><i data-lucide="help-circle" class="w-3.5 h-3.5"></i> Help & Support</a>
                </div>
            `;
        };

        const renderMainContent = () => {
             let content = '';
            if (state.isGenerating) {
                content = `
                    <div class="text-center p-10">
                        <div class="relative inline-block">
                            <div class="w-16 h-16 border-4 border-dashed rounded-full animate-spin border-orange-500"></div>
                            <i data-lucide="brain-circuit" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-orange-500" style="width: 32px; height: 32px;"></i>
                        </div>
                        <h3 class="text-xl font-semibold mt-6 text-slate-700">The AI is searching for information...</h3>
                        <p class="text-gray-500 mt-2">Please wait a moment.</p>
                    </div>`;
            } else if (state.report && (state.activeView === 'New Chat' || state.activeView === 'Projects')) {
                // *** NEW TWO-COLUMN LAYOUT FOR RESULTS ***
                content = `
                    <div class="w-full max-w-7xl mx-auto flex flex-col lg:flex-row gap-8 animate-fade-in">
                        <div class="flex-grow lg:w-2/3 space-y-8">
                            <div>
                                <h2 class="text-2xl font-bold text-slate-800 mb-4 flex items-center gap-3"><i data-lucide="file-text" class="text-orange-500"></i>Full Report</h2>
                                <div class="prose prose-sm md:prose-base bg-white p-6 rounded-xl border border-gray-200 shadow-sm">${state.report.fullReport}</div>
                            </div>
                        </div>

                        <div class="lg:w-1/3 space-y-8 flex-shrink-0">
                             <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                                <h2 class="text-xl font-bold text-slate-800 mb-4">Actions</h2>
                                <button id="save-project-btn" class="w-full flex items-center justify-center gap-2 text-sm bg-green-100 text-green-700 font-semibold px-4 py-2.5 rounded-lg hover:bg-green-200 transition-colors">
                                    <i data-lucide="save" class="w-4 h-4"></i>Save to Project
                                </button>
                             </div>

                            <div>
                               <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-3"><i data-lucide="star" class="text-orange-500"></i>Key Takeaways</h2>
                                <div class="space-y-3 bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                                    ${state.report.keyTakeaways.map(item => `<div class="flex items-start gap-3"><span class="text-green-500 mt-1.5">&#10003;</span><span>${item}</span></div>`).join('')}
                                </div>
                            </div>
                           
                            <div>
                                <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-3"><i data-lucide="book-open" class="text-orange-500"></i>Sources</h2>
                                <div class="space-y-3">
                                    ${state.report.sources.map(source => `
                                        <a href="${source.url}" target="_blank" rel="noopener noreferrer" class="block bg-white p-4 rounded-xl border border-gray-200 shadow-sm hover:border-orange-400 transition-colors">
                                            <div class="flex items-center justify-between gap-4">
                                                <div>
                                                    <p class="font-semibold text-slate-700">${source.title}</p>
                                                    <p class="text-xs text-orange-600 flex items-center gap-1">View Source <i data-lucide="external-link" class="w-3 h-3"></i></p>
                                                </div>
                                                <span class="text-xs font-medium px-2 py-1 rounded-full ${source.type === 'Live Data' ? 'bg-green-100 text-green-700' : 'bg-blue-100 text-blue-700'} flex-shrink-0">${source.type}</span>
                                            </div>
                                        </a>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    </div>`;
            } else if (state.activeView === 'Writer') {
                content = `
                    <div class="w-full max-w-4xl mx-auto animate-fade-in h-full flex flex-col">
                        <div class="flex-shrink-0 mb-4">
                            <h2 class="text-2xl font-bold text-slate-800 flex items-center gap-3"><i data-lucide="edit-3" class="text-orange-500"></i>Writer</h2>
                            <p class="text-gray-500">Compose, edit, and format your research notes and reports.</p>
                        </div>
                        <div class="bg-white p-1 rounded-xl border border-gray-200 shadow-sm flex-grow flex flex-col">
                           <div class="p-4 border-b border-gray-200">
                                <input type="text" placeholder="Untitled Document" class="text-lg font-semibold w-full focus:outline-none bg-transparent">
                           </div>
                           <div class="p-2 border-b border-gray-200 flex items-center gap-2 text-gray-500">
                                <button class="hover:bg-gray-100 p-2 rounded-md"><i data-lucide="bold" class="w-4 h-4"></i></button>
                                <button class="hover:bg-gray-100 p-2 rounded-md"><i data-lucide="italic" class="w-4 h-4"></i></button>
                                <button class="hover:bg-gray-100 p-2 rounded-md"><i data-lucide="underline" class="w-4 h-4"></i></button>
                                <div class="h-5 border-l border-gray-300 mx-1"></div>
                                <button class="hover:bg-gray-100 p-2 rounded-md"><i data-lucide="list" class="w-4 h-4"></i></button>
                                <button class="hover:bg-gray-100 p-2 rounded-md"><i data-lucide="list-ordered" class="w-4 h-4"></i></button>
                           </div>
                           <textarea class="w-full h-full p-4 focus:outline-none resize-none text-slate-700 bg-transparent" placeholder="Start writing your content here..."></textarea>
                        </div>
                    </div>
                `;
            } else if (state.activeView === 'Library') {
                content = `
                    <div class="w-full max-w-5xl mx-auto animate-fade-in">
                        <div class="mb-6">
                            <h2 class="text-2xl font-bold text-slate-800 flex items-center gap-3"><i data-lucide="library" class="text-orange-500"></i>Library</h2>
                            <p class="text-gray-500">Browse your saved documents, reports, and analyses.</p>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            ${mockLibraryItems.map(item => `
                                <div class="bg-white p-5 rounded-xl border border-gray-200 shadow-sm hover:shadow-lg hover:-translate-y-1 transition-all cursor-pointer">
                                    <div class="flex items-center gap-3 mb-3">
                                        <i data-lucide="${item.type === 'Report' ? 'file-text' : 'file-pen-line'}" class="w-5 h-5 text-orange-500"></i>
                                        <h3 class="font-semibold text-slate-800 truncate">${item.title}</h3>
                                    </div>
                                    <p class="text-xs text-gray-500">Last updated: ${item.date}</p>
                                    <span class="mt-3 inline-block text-xs font-medium px-2 py-1 rounded-full bg-gray-100 text-gray-700">${item.type}</span>
                                </div>
                            `).join('')}
                             <div class="bg-gray-50/80 border-2 border-dashed border-gray-300 p-5 rounded-xl hover:border-orange-400 hover:bg-white transition-all flex flex-col items-center justify-center text-center cursor-pointer">
                                <i data-lucide="plus-circle" class="w-8 h-8 text-gray-400 mb-2"></i>
                                <h3 class="font-semibold text-slate-600">Create New</h3>
                                <p class="text-xs text-gray-500">Start a new document</p>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                 content = `
                    <div class="w-full max-w-4xl mx-auto text-center animate-fade-in">
                         <h2 class="text-4xl md:text-5xl font-bold text-slate-800 mb-4">
                            ${state.activeView === 'New Chat' ? 'Research Discovery' : `${state.activeView}`}
                        </h2>
                        <p class="text-gray-500 text-lg max-w-2xl mx-auto mb-8">
                            ${state.activeView === 'New Chat' ? 'Search across millions of academic papers, articles, and sources.' : `Welcome to the ${state.activeView} section. Backend functionality can be added here.`}
                        </p>
                        ${state.activeView === 'New Chat' ? `
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-left">
                                <div class="bg-white p-4 rounded-xl border border-gray-200/80 hover:bg-gray-50 cursor-pointer suggestion-card">What are the latest trends in renewable energy?</div>
                                <div class="bg-white p-4 rounded-xl border border-gray-200/80 hover:bg-gray-50 cursor-pointer suggestion-card">Summarize recent breakthroughs in quantum computing.</div>
                            </div>
                        ` : ''}
                    </div>`;
            }
            mainContentArea.innerHTML = content;
        };

        const renderInputArea = () => {
            if (state.activeView !== 'New Chat') {
                inputAreaContainer.innerHTML = '';
                return;
            }

            const filesHtml = state.uploadedFiles.map(file => `
                <div class="flex items-center gap-2 bg-gray-100 text-xs px-2 py-1 rounded-full animate-fade-in">
                    <i data-lucide="file-text" class="w-3 h-3 text-gray-500"></i>
                    <span class="text-gray-700 truncate max-w-[120px] sm:max-w-xs">${file.name}</span>
                    <button class="remove-file-btn text-gray-400 p-0.5 hover:bg-red-100 hover:text-red-500 rounded-full" data-filename="${file.name}">
                        <i data-lucide="x" class="w-3 h-3"></i>
                    </button>
                </div>
            `).join('');

            inputAreaContainer.innerHTML = `
                ${state.uploadedFiles.length > 0 ? `<div class="flex justify-center flex-wrap gap-2 mb-3">${filesHtml}</div>` : ''}
                <div class="bg-white border border-gray-200/80 rounded-full shadow-lg shadow-gray-200/50 p-2 flex items-center gap-2 w-full">
                    <label for="file-upload-btn" class="p-2 text-gray-500 hover:text-orange-600 hover:bg-orange-100 rounded-full cursor-pointer transition-colors">
                        <i data-lucide="upload" class="w-5 h-5"></i>
                    </label>
                    <input id="file-upload-btn" type="file" multiple class="hidden" />
                    <textarea id="question-input" rows="1" class="w-full bg-transparent p-2 focus:outline-none resize-none text-slate-800 placeholder-gray-400 text-base" placeholder="What research are you looking for?">${state.question}</textarea>
                    <button id="generate-btn" class="bg-orange-500 text-white rounded-full p-2.5 hover:bg-orange-600 disabled:bg-gray-400 disabled:cursor-not-allowed transition-all transform hover:scale-110 flex-shrink-0">
                        <i data-lucide="${state.isGenerating ? 'loader' : 'arrow-right'}" class="${state.isGenerating ? 'animate-spin' : ''} w-5 h-5"></i>
                    </button>
                </div>
                ${state.error ? `<p class="text-red-500 text-xs mt-2 text-center">${state.error}</p>` : ''}
            `;
        };

        const updateCounters = () => {
            questionsAskedEl.textContent = state.questionsAsked;
            reportsGeneratedEl.textContent = state.reportsGenerated;
        };

        const render = () => {
            renderSidebar();
            renderMainContent();
            renderInputArea();
            updateCounters();
            addEventListeners();
            lucide.createIcons();
            
            const textarea = document.getElementById('question-input');
            if (textarea) {
                textarea.style.height = 'auto';
                textarea.style.height = (textarea.scrollHeight) + 'px';
            }
        };

        const handleGenerateReport = () => {
            if (!state.question.trim()) {
                state.error = 'Please enter a question or topic to research.';
                render();
                return;
            }
            state.error = '';
            state.isGenerating = true;
            state.report = null;
            
            const trimmedQuestion = state.question.trim();
            if (!state.history.includes(trimmedQuestion)) {
                state.history.unshift(trimmedQuestion);
                state.history = state.history.slice(0, 20);
            }
            state.questionsAsked++;
            
            render();

            setTimeout(() => {
                state.report = createMockReport(state.questionsAsked, state.reportsGenerated);
                state.reportsGenerated++;
                state.isGenerating = false;
                saveState();
                render();
            }, 2000);
        };

        const addEventListeners = () => {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const view = item.dataset.view;
                    if (view === 'New Chat') {
                        state.question = '';
                        state.uploadedFiles = [];
                        state.report = null;
                        state.error = '';
                    }
                    state.activeView = view;
                    render();
                });
            });
            
            document.querySelectorAll('.history-item').forEach(item => {
                item.addEventListener('click', () => {
                    state.question = item.textContent;
                    state.activeView = 'New Chat';
                    render();
                });
            });

            document.querySelectorAll('.suggestion-card').forEach(card => {
                card.addEventListener('click', () => {
                    state.question = card.textContent;
                    handleGenerateReport();
                })
            });
            
            document.querySelectorAll('.project-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    const projectName = e.currentTarget.dataset.projectname;
                    const project = state.projects.find(p => p.name === projectName);
                    if (project) {
                        state.question = project.question;
                        state.report = project.report;
                        state.uploadedFiles = [];
                        state.activeView = 'New Chat';
                        render();
                    }
                });
            });
            
            const saveProjectBtn = document.getElementById('save-project-btn');
            if (saveProjectBtn) {
                saveProjectBtn.addEventListener('click', () => {
                    const projectName = prompt("Enter a name for this project:", state.question.substring(0, 30));
                    if (projectName && projectName.trim() !== '') {
                         state.projects.unshift({ name: projectName.trim(), question: state.question, report: state.report });
                         saveState();
                         render();
                         alert(`Project "${projectName.trim()}" saved!`);
                    }
                });
            }

            const clearHistoryBtn = document.getElementById('clear-history-btn');
            if (clearHistoryBtn) {
                clearHistoryBtn.addEventListener('click', () => {
                    if(confirm('Are you sure you want to clear all recent searches?')) {
                        state.history = [];
                        saveState();
                        render();
                    }
                });
            }

            const clearProjectsBtn = document.getElementById('clear-projects-btn');
            if (clearProjectsBtn) {
                clearProjectsBtn.addEventListener('click', () => {
                     if(confirm('Are you sure you want to delete all saved projects?')) {
                        state.projects = [];
                        saveState();
                        render();
                    }
                });
            }

            if (state.activeView === 'New Chat') {
                const generateBtn = document.getElementById('generate-btn');
                if (generateBtn) generateBtn.addEventListener('click', handleGenerateReport);

                const questionInput = document.getElementById('question-input');
                if (questionInput) {
                    questionInput.addEventListener('input', (e) => {
                        state.question = e.target.value;
                        e.target.style.height = 'auto';
                        e.target.style.height = (e.target.scrollHeight) + 'px';
                        if (state.error) {
                            state.error = '';
                            renderInputArea();
                        }
                    });
                    questionInput.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' && !e.shiftKey) {
                            e.preventDefault();
                            handleGenerateReport();
                        }
                    });
                }

                const fileUploadBtn = document.getElementById('file-upload-btn');
                if (fileUploadBtn) {
                    fileUploadBtn.addEventListener('change', (e) => {
                        if (e.target.files.length) {
                            const newFiles = Array.from(e.target.files).map(file => ({ name: file.name }));
                            state.uploadedFiles = [...state.uploadedFiles, ...newFiles].slice(0, 5);
                            render();
                        }
                    });
                }
                
                document.querySelectorAll('.remove-file-btn').forEach(btn => {
                   btn.addEventListener('click', (e) => {
                       const filename = e.currentTarget.dataset.filename;
                       state.uploadedFiles = state.uploadedFiles.filter(f => f.name !== filename);
                       render();
                   })
                });
            }
        };

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            const splashScreen = document.getElementById('splash-screen');
            const appWrapper = document.getElementById('app-wrapper');

            setTimeout(() => {
                splashScreen.classList.add('opacity-0');
                setTimeout(() => {
                    splashScreen.style.display = 'none';
                    appWrapper.classList.remove('hidden');
                    loadState();
                    render();
                }, 500);
            }, 1500); // Reduced splash screen time
        });
    </script>
</body>
</html>